### éåŒæ­¥æ“ä½œ


---
é–±è®€åˆ—è¡¨:
 - [Callback](#^2b0bfb)
 - [XMLHttpRequest](#^a7c13f)
 - [Promise](#^aa0411)
 - [Async/Await](#^15ed02)
 - [Fetch](#^a3383b)
	 \* [XMLHttpRequest VS. Fetch](#^ddf68b)
 - [AJAX](#^5516fd)
---


#### ğŸ”µ Callback: å°‡å‡½å¼ä½œç‚ºåƒæ•¸å‚³å…¥å…¶ä»–å‡½å¼ 

^2b0bfb

---
å°‡å‡½å¼Aä½œç‚ºåƒæ•¸å‚³å…¥Bå‡½å¼ æ–¼Bä¸­å‘¼å«A ä½¿Aåœ¨æŒ‡å®šæ™‚æ©ŸåŸ·è¡Œ
å› å°‡å‡½å¼æ§åˆ¶æ¬Š(å‘¼å«æ¬Š)äº¤å‡º æ•…é›£ä»¥æŒæ¡å…¶ä»–å‘¼å«ç´°ç¯€ ä¸”é›£è™•ç†å¤šå±¤ä¾è³´

```js=
function process(data,next){
	console.log(`${data}è™•ç†ä¸­`);
	next(data);
}
function end(data){
	console.log(`${data}è™•ç†å®Œç•¢!`);
}

process("è³‡æ–™001",end);
```


#### ğŸŸ  XMLHttpRequestç‰©ä»¶: ç¶²é éƒ¨åˆ†æ›´æ–°

^a7c13f
---
 ä¸€browserå…§å»ºç‰©ä»¶ ç”¨æ–¼ **åœ¨èƒŒæ™¯** èˆ‡serveräº¤æ›è³‡æ–™(ç™¼é€HTTPè«‹æ±‚èˆ‡è™•ç†å›æ‡‰) ä½¿ç¶²é ä¸éœ€æ•´é åˆ·æ–°ä¹Ÿèƒ½æ›´æ–°å…§å®¹

XHRç‰©ä»¶ç‹€æ…‹è®ŠåŒ–:
```txt=
0 unsent: å·²å»ºç«‹XHRç‰©ä»¶ å°šæœªåˆå§‹åŒ–(å°šæœªå‘¼å«.open())

1 opened: å·²è¨­å®šè«‹æ±‚åƒæ•¸ å°šæœªé€å‡º(å°šæœªå‘¼å«.send())

2 headers_received: å·²é€å‡ºè«‹æ±‚ä¸”æ”¶åˆ°ç‹€æ…‹ç¢¼èˆ‡å›æ‡‰headers å°šæœªæ”¶åˆ°å›æ‡‰body

3 loading: æ­£åœ¨æ¥æ”¶å›æ‡‰bodyçš„è³‡æ–™

4 done: è«‹æ±‚æ“ä½œå®Œæˆ
```
\*å¯é€é.readyStateå±¬æ€§æŸ¥çœ‹ ç‹€æ…‹è®ŠåŒ–æœƒè§¸ç™¼readystatechangeäº‹ä»¶

å»ºç«‹èˆ‡åˆå§‹åŒ–( 0 --> 1 ):
```js=
const xhr= new XMLHttpRequest();
xhr.open(è«‹æ±‚æ–¹æ³•, URL, æ˜¯å¦åŒæ­¥); //è¨­å®šè«‹æ±‚åƒæ•¸
```
è¨­å®šå›æ‡‰è™•ç†:
```js=
xhr.addEventListener("load",function(){...}); //è«‹æ±‚å®Œæˆä¸”ä¼ºæœå™¨å›æ‡‰è§¸ç™¼loadäº‹ä»¶(æ“ä½œä¸ä¸€å®šæˆåŠŸ)
xhr.addEventListener("error",function(){...}); //è«‹æ±‚å¤±æ•—è§¸ç™¼
```
ç™¼é€è«‹æ±‚( 1 --> 2):
```js=
xhr.send();
```


>â–«ï¸XHRç‰©ä»¶çš„å±¬æ€§èˆ‡æ–¹æ³•
>	- .readyState: è«‹æ±‚ç‹€æ…‹
>	- .timeout: è¨­å®šè«‹æ±‚ç­‰å¾…æ™‚é–“
>	- .status: ä¼ºæœå™¨å›æ‡‰çš„HTTPç‹€æ…‹ç¢¼
>	- .responseText: ä¼ºæœå™¨å›æ‡‰è³‡æ–™ ç‚ºæ–‡å­—å½¢å¼
>	- .open( )
>	- .send( )
>	- .abort( ): çµ‚æ­¢ç™¼é€çš„è«‹æ±‚
>	- setRequestHeader( ): è¨­å®šè«‹æ±‚æ¨™é ­ åƒ…å¯åœ¨.open()å¾Œã€.send()å‰å‘¼å«
>â–«ï¸è§¸ç™¼äº‹ä»¶
>	- load
>	- error
>	- abort: è«‹æ±‚è¢«å–æ¶ˆ
>	- progress: xhræ­£åœ¨ä¸‹è¼‰(æ¥æ”¶)å›æ‡‰è³‡æ–™
>	- timeout: è«‹æ±‚é€¾æ™‚

```js=
const xhr= new XMLHttpRequest();
xhr.open('GET','https://jsonplaceholder.typicode.com/todos/1',true);
xhr.timeout= 2000; //è¨­å®šè«‹æ±‚ç­‰å¾…2000æ¯«ç§’

xhr.addEventListener("error",()=>{
	console.log('è«‹æ±‚ç™¼é€å¤±æ•—');
});
xhr.addEventListener("load",()=>{
	if(xhr.status==200){
		console.log('æ“ä½œåŸ·è¡ŒæˆåŠŸ!');
		console.log(`ä»¥ä¸‹ç‚ºåŸ·è¡Œçµæœ: ${xhr.responseText}`);
	}else{
		console.log('æ“ä½œåŸ·è¡Œå¤±æ•—');
	}
});
xhr.addEventListener("timeout",()=>{
	console.log('è«‹æ±‚é€¾æ™‚');
});

xhr.send();
```
\*ç¾é€šå¸¸ä½¿ç”¨fetch( )



#### ğŸ”µ Promise:  JSä¸­ç”¨æ–¼è™•ç†éåŒæ­¥æ“ä½œçš„ç‰©ä»¶

^aa0411

---
è¡¨ç¤ºä¸€ **å°šæœªå®Œæˆä½†æ™šé»æœƒå¾—åˆ°å›æ‡‰** çš„æ“ä½œ, åœ¨callbackçš„åŸºç¤ä¸ŠåŠ å¼·

> â–«ï¸ç‹€æ…‹æ©Ÿåˆ¶: Promiseåˆ†ç‚ºä¸‰ç¨®ç‹€æ…‹ åˆ†åˆ¥ç‚ºpending(å°šæœªæ“ä½œ: ç‚ºPromiseçš„åˆå§‹ç‹€æ…‹), fulfilled(æ“ä½œå®Œæˆ), rejected(æ“ä½œå¤±æ•—), ä¸€æ—¦Promiseç‰©ä»¶ **ç‹€æ…‹æ”¹è®Šå°±æœƒå›ºå®š**(ä¸å¯é€†æ“ä½œ)
>
>â–«ï¸éŒ¯èª¤å‚³é: .catch()æœƒæ•æ‰å‰æ–¹çš„æ‰€æœ‰éŒ¯èª¤
>
>â–«ï¸éˆå¼çµæ§‹: å¤šå±¤ä¾è³´é—œä¿‚ä½¿ç”¨.then()ä¸²æ¥

ä½¿ç”¨:
1. å»ºç«‹
```js=
const myPromise= new Promise((resolve,reject)=>{
	if(æˆåŠŸæ¢ä»¶){
		resolve(response)
	}else{
		reject(reason)
	}
})
```
* resolve(response): å°‡promiseçš„ç‹€æ…‹æ”¹ç‚ºfulfilled ä¸¦æŠŠresponseå‚³å…¥.then()
* reject(reason): å°‡promiseçš„ç‹€æ…‹æ”¹ç‚ºrejected ä¸¦æŠŠreasonå‚³å…¥.catch()
* Promiseä¸æœƒè‡ªå‹•rejected é ˆåœ¨å‡½å¼å…§æ‰‹å‹•reject


2. ç›£è½
```js=
myPromise.then(...)
.then(...)
...
.catch(...)
```
- .then(): æœƒæ¥æ”¶å‰ä¸€å€‹.then()çš„å›å‚³å€¼ä½œç‚ºåƒæ•¸ è‹¥å›å‚³å€¼ç‚ºPromiseç‰©ä»¶ JSæœƒç­‰å¾…å…¶åŸ·è¡Œå®Œç•¢
- .catch(): æ•æ‰å‰æ–¹æ‰€æœ‰éŒ¯èª¤ è‹¥å‰æ–¹æœ‰ä¸€.then()å ±éŒ¯æœƒç›´æ¥è·³åˆ°.catch()

å¸¸ç”¨æ–¹æ³•:
- Promise.all(Promiseç‰©ä»¶é™£åˆ—): ç­‰å¾…æ‰€æœ‰Promiseå®Œæˆä¸¦å›å‚³ä¸€çµæœé™£åˆ— è‹¥å…¶ä¸­æœ‰ä¸€Promiseå ±éŒ¯æœƒç›´æ¥è·³è‡³.catch()

- Promise.allSettled: ç­‰å¾…æ‰€æœ‰Promiseå®Œæˆä¸¦å›å‚³ä¸€çµæœç‰©ä»¶é™£åˆ— å³ä½¿å…¶ä¸­ä¸€Promiseå ±éŒ¯ä¹Ÿä¸æœƒåœæ­¢

- Promise.race(Promiseç‰©ä»¶é™£åˆ—): å›å‚³æœ€å¿«å®Œæˆçš„Promiseç‰©ä»¶(å¯èƒ½ç‚ºfulfilledæˆ–rejected)

- Promise.any(Promiseç‰©ä»¶é™£åˆ—): å›å‚³æœ€å¿«æˆåŠŸ(fulfilled)çš„Promiseç‰©ä»¶ æœƒå¿½ç•¥å¤±æ•—ç›´åˆ°æ‰€æœ‰Promiseéƒ½å¤±æ•—æ‰å ±éŒ¯



#### ğŸ”µ Async/Await: Promiseçš„èªæ³•ç³–

^15ed02

---
>â–«ï¸**async**: ç½®æ–¼å‡½å¼é–‹é ­ è¡¨ç¤ºæ­¤å‡½å¼æœ€å¾Œæœƒå›å‚³ä¸€Promiseç‰©ä»¶ (è‹¥éPromiseæœƒè¢«åŒ…è£)
>
>â–«ï¸**await**: åªèƒ½å¯«åœ¨asyncå‡½å¼ä¸­ ç½®æ–¼statementå‰ ç”¨æ–¼ç­‰å¾…PromiseåŸ·è¡Œå®Œç•¢ ç¨‹å¼é‡åˆ°awaité—œéµå­—æœƒæš«åœæ•´å€‹asyncå‡½å¼ç›´åˆ°PromiseåŸ·è¡Œå®Œç•¢(ç‹€æ…‹æ”¹è®Š) ä½†ä¸»å‡½å¼æœƒç¹¼çºŒåŸ·è¡Œ

\*async/awaitå¯«æ³•ä¸­é™¤éŒ¯æœƒä½¿ç”¨try{  }catch( ){  }```

```js=
async function processor(data,time){
	try{
		if(time<0){
			throw new Error('æ™‚é–“ä¸å¯ç‚ºè² æ•¸!');
		}
		await new Promise((resolve)=>{
			setTimeout(()=>{
				console.log(`${data}è™•ç†ä¸­...`);
				resolve(); //awaitæœƒç­‰å¾…Promiseç‹€æ…‹è½‰è®Š
			},time);	
		});	
		console.log(`${data}è™•ç†å®Œç•¢!`);
	}catch(e){
		console.log(`something wrong: ${e.message}`);
	}
}
processor('è³‡æ–™1',2000);
processor('è³‡æ–™2',-1); //something wrong: æ™‚é–“ä¸å¯ç‚ºè² æ•¸!
```
\*è‹¥asyncå‡½å¼æ²’æœ‰æ˜ç¢ºreturnæœƒå›å‚³undefined æ•…ä»¥ä¸Šç¨‹å¼æœƒå›å‚³undefined


#### ğŸŸ  Fetch: åŸºæ–¼Promiseç™¼å‡ºHTTPè«‹æ±‚

^a3383b

---

ä¸€åŸºæ–¼Promiseç‰©ä»¶çš„API ç”¨æ–¼å‘æŒ‡å®šç¶²å€ç™¼é€HTTPè«‹æ±‚


èªæ³•:
```js=
fetch(URL,è«‹æ±‚åƒæ•¸);
```
\*å‡½å¼æœƒå›å‚³ä¸€Promiseç‰©ä»¶(ä»£è¡¨æ­£åœ¨ç­‰å¾…HTTPå›æ‡‰) ç•¶è«‹æ±‚è¢«å›è¦†æ™‚ æœƒå°‡å…¶ç‹€æ…‹æ”¹ç‚ºfulfilled(ä»£è¡¨fetchæ“ä½œæˆåŠŸ) ä¸¦å›å‚³ä¸€Responseç‰©ä»¶, åƒ…è«‹æ±‚ç„¡æ³•é€é”(ç¶²è·¯å±¤éŒ¯èª¤)æ™‚æœƒrejected(**æ•…å³ä½¿æ“ä½œåŸ·è¡Œå¤±æ•—ä¹Ÿç‚ºfulfilled**)

å¸¸è¦‹è«‹æ±‚åƒæ•¸:
- method (æ–¹æ³•):
	GET, POST, PUT, DELETE
- headers (æ¨™é ­):
	Content-Type(è³‡æ–™æ ¼å¼), Accept(å›æ‡‰æ ¼å¼), ...
- body (ä¸»é«”å…§å®¹)

```js=
fetch('https://jsonplaceholder.typicode.com/todos/1'{
	method: 'POST', //ä½¿ç”¨çš„HTTPæ–¹æ³•
	headers: {
		'Content-type': 'application/json', //è«‹æ±‚æ‰€å«è³‡æ–™é¡å‹
	}
	body: JSON.stringify({
		key: 'value', //è«‹æ±‚æ‰€å‚³éä¹‹è³‡æ–™
	})
});
```

>â–«ï¸Responseç‰©ä»¶çš„å±¬æ€§èˆ‡æ–¹æ³•
>	-  .ok: å›å‚³Responseæ“ä½œæ˜¯å¦æˆåŠŸ(HTTPç‹€æ…‹ç¢¼æ–¼200-299)
>	-  .status: å›å‚³Responseçš„HTTPç‹€æ…‹ç¢¼
>	-  .json( )/ .text( )/ .formData( )/ ... : å°‡Responseè§£æç‚ºæŒ‡å®šè³‡æ–™æ ¼å¼å›å‚³ (å›å‚³ç‚ºä¸€Promise) 

Promiseå¯«æ³•:
```js=
fetch('https://jsonplaceholder.typicode.com/todos/1')
.then((response)=>{
	if(response.ok){
		return response;
	}else{
		throw new Error('æ“ä½œåŸ·è¡Œå¤±æ•—');
	}
}).then((result)=>{
	console.log('æ“ä½œåŸ·è¡ŒæˆåŠŸ!');
	return result.json(); //.json()æœƒå°‡responseè§£æç‚ºJSç‰©ä»¶
}).then((data)=>{
	console.log('ä»¥ä¸‹ç‚ºåŸ·è¡Œçµæœ:' ,data);
}).catch((reason)=>{
	console.log(`HTTPè«‹æ±‚å¤±æ•—: ${reason}`);
});
```

Async/Awaitå¯«æ³•:
```js=
async function httpRequest(URL){
	try{
		const request= await fetch(URL);
		if(request.ok){
			console.log('æ“ä½œåŸ·è¡ŒæˆåŠŸ!');
			const data= await request.json();
			console.log('ä»¥ä¸‹ç‚ºåŸ·è¡Œçµæœ:' ,data);
		}else{
			throw new Error('æ“ä½œåŸ·è¡Œå¤±æ•—');
		}
	}catch(error){
		console.log(`HTTPè«‹æ±‚å¤±æ•—: ${error}`);
	}
}
httpRequest('https://jsonplaceholder.typicode.com/todos/1');
```

##### ğŸ”¸XMLHttpRequest VS. Fetch

^ddf68b

|      | XMLHttpRequest |             Fetch              |
| :--: | :------------: | :----------------------------: |
|  æ ¸å¿ƒ  |   åŸºæ–¼callback   |           åŸºæ–¼Promise            |
|  èªæ³•  |       è¤‡é›œ       |               ç°¡æ½”               |
| éŒ¯èª¤è™•ç† |      ä½¿ç”¨äº‹ä»¶      | éˆå¼.catch( )/ try{ }catch( ){ } |
| è«‹æ±‚çµ‚æ­¢ |    abort( )    |             åŸç”Ÿä¸æ”¯æ´              |
| é€²åº¦ç›£æ§ |   progressäº‹ä»¶   |             åŸç”Ÿä¸æ”¯æ´              |



#### ğŸŸ  AJAX (Asynchronous JavaScript and XML): ä¸€ç¨®å‰ç«¯æ“ä½œæ¨¡å¼

^5516fd
---

ç”¨æ–¼ç¶²é å‰ç«¯èˆ‡ä¼ºæœå™¨é–“æºé€šçš„æŠ€è¡“: ç¶²é ç™¼é€è«‹æ±‚ & ä¼ºæœå™¨å›æ‡‰
è®“ç¶²é èƒ½åœ¨ä¸é‡æ–°æ•´ç†é é¢çš„æƒ…æ³ä¸‹å‹•æ…‹åˆ·æ–°è³‡æ–™(éåŒæ­¥äº¤æ›è³‡æ–™)

æ§‹æˆè¦ç´ :
- JavaScript: ç™¼é€è«‹æ±‚
- XHR (XMLHttpRequest)/ Fetch( ): èˆ‡Serverç«¯äº¤æ›è³‡æ–™
- Serverç«¯èªè¨€(PHP, Node.jsç­‰): è™•ç†è«‹æ±‚
- è³‡æ–™æ ¼å¼(XML, JSONç­‰)

é‹ä½œæµç¨‹:
	ä½¿ç”¨è€…è§¸ç™¼äº‹ä»¶
		â†“
	JavaScriptå»ºç«‹è«‹æ±‚(fetch/ XHR)
		â†“
	Serverç«¯æ¥æ”¶è™•ç† ä¸¦å›å‚³æŒ‡å®šæ ¼å¼è³‡æ–™
		â†“
	JavaScriptè§£æè³‡æ–™ ä¸¦æ›´æ–°éƒ¨åˆ†é é¢